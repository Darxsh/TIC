document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelector(".join-form");function t(e,t){e.classList.add("invalid");const o=document.createElement("span");o.className="error-message",o.textContent=t,e.parentElement.appendChild(o)}function o(e,t){let o=document.querySelector(".notification");o||(o=document.createElement("div"),o.className="notification",document.body.appendChild(o)),o.textContent=e,o.className=`notification ${t}`,o.style.display="block",setTimeout((()=>{o.style.display="none"}),5e3)}e&&e.addEventListener("submit",(async function(n){n.preventDefault();const i={},r=e.querySelectorAll("input, select, textarea");r.forEach((e=>{"checkbox"===e.type?i[e.name]=e.checked:e.name&&(i[e.name]=e.value.trim())})),r.forEach((e=>{e.classList.remove("invalid");const t=e.parentElement.querySelector(".error-message");t&&t.remove()}));const s=e.querySelectorAll("[required]");let a=!0,c=null;if(s.forEach((e=>{e.value.trim()||(a=!1,t(e,"This field is required"),c||(c=e))})),!a)return o("Please fill all required fields marked with *","error"),c.focus(),!1;if(!grecaptcha.getResponse())return o("Please complete the reCAPTCHA verification","error"),!1;await async function(n){try{o("Processing your application...","info");const i=await fetch("/api/join",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),r=await i.json();if(!i.ok){if(r.field){const o=e.querySelector(`[name="${r.field}"]`);o&&(t(o,r.message),o.focus())}throw new Error(r.message||"Submission failed")}e.reset(),grecaptcha.reset(),o(r.message||"Application submitted successfully! Please check your email.","success"),window.scrollTo({top:0,behavior:"smooth"})}catch(e){console.error("Submission error:",e),o(e.message||"Submission failed. Please try again.","error")}}(i)}))}));