document.addEventListener("DOMContentLoaded",(function(){const e=document.querySelectorAll(".gallery-item"),t=document.querySelectorAll(".filter-btn"),i=document.querySelector(".search-input"),o=document.querySelector(".lightbox"),s=document.querySelector(".lightbox-content"),n=document.querySelector(".lightbox-title"),c=document.querySelector(".lightbox-desc"),r=document.querySelector(".close-lightbox"),a=document.querySelector(".prev-btn"),l=document.querySelector(".next-btn"),d=document.querySelector(".image-counter"),u=document.querySelector(".load-more-btn"),m=document.querySelectorAll(".view-btn"),y=document.querySelector(".gallery-container");let v=0,h=[],f="grid";function p(){h=Array.from(e).filter((e=>"none"!==e.style.display&&e.classList.contains("visible")))}function g(){d.textContent=`${v+1} / ${h.length}`}function L(e){const t=h[e],i=t.querySelector(".item-caption h3").textContent,o=t.querySelector(".item-caption p").textContent,n=null!==t.querySelector(".video-indicator");if(s.innerHTML="",n){const e=document.createElement("video");e.src=t.querySelector("video").src,e.controls=!0,e.autoplay=!0,s.appendChild(e)}else{const e=document.createElement("img");e.src=t.querySelector("img").src,e.alt=t.querySelector("img").alt,s.appendChild(e)}const c=document.createElement("div");c.className="lightbox-info",c.innerHTML=`\n            <h3 class="lightbox-title">${i}</h3>\n            <p class="lightbox-desc">${o}</p>\n        `,s.appendChild(c),g()}if(e.forEach(((e,t)=>{t<16?setTimeout((()=>{e.classList.add("visible")}),100*t):e.style.display="none"})),u.addEventListener("click",(function(){let t=Array.from(e).filter((e=>"none"===e.style.display));if(t.length>0){t.slice(0,8).forEach(((e,t)=>{e.style.display="block",setTimeout((()=>{e.classList.add("visible")}),100*t)})),t.length<=8&&(u.style.display="none")}})),m.forEach((t=>{t.addEventListener("click",(function(){const t=this.getAttribute("data-view");m.forEach((e=>e.classList.remove("active"))),this.classList.add("active"),"grid"===t?(y.classList.remove("masonry-view"),f="grid"):"masonry"===t&&(y.classList.add("masonry-view"),f="masonry"),"masonry"===f?e.forEach((e=>{e.classList.remove("featured-item","wide-item","tall-item")})):e.forEach((e=>{e.hasAttribute("data-featured")&&e.classList.add("featured-item"),e.hasAttribute("data-wide")&&e.classList.add("wide-item"),e.hasAttribute("data-tall")&&e.classList.add("tall-item")}))}))})),t.forEach((i=>{i.addEventListener("click",(function(){const i=this.getAttribute("data-filter");t.forEach((e=>e.classList.remove("active"))),this.classList.add("active"),e.forEach((e=>{const t=e.getAttribute("data-category");e.style.display="none",e.classList.remove("visible"),"all"!==i&&t!==i||(e.style.display="block",setTimeout((()=>{e.classList.add("visible")}),300*Math.random()))})),setTimeout(p,500);let o=Array.from(e).filter((e=>"none"===e.style.display));u.style.display=o.length>0?"inline-block":"none"}))})),i.addEventListener("input",(function(){const t=this.value.toLowerCase().trim();e.forEach((e=>{const i=e.querySelector(".item-caption h3").textContent.toLowerCase(),o=e.querySelector(".item-caption p").textContent.toLowerCase(),s=e.getAttribute("data-tags")?e.getAttribute("data-tags").toLowerCase():"";e.style.display="none",e.classList.remove("visible"),(""===t||i.includes(t)||o.includes(t)||s.includes(t))&&(e.style.display="block",setTimeout((()=>{e.classList.add("visible")}),300*Math.random()))})),setTimeout(p,500)})),e.forEach(((e,t)=>{e.addEventListener("click",(function(){const e=this.querySelector(".item-caption h3").textContent,t=this.querySelector(".item-caption p").textContent,i=null!==this.querySelector(".video-indicator");if(n.textContent=e,c.textContent=t,s.innerHTML="",i){const e=document.createElement("video");e.src=this.querySelector("video").src,e.controls=!0,e.autoplay=!0,s.appendChild(e)}else{const e=document.createElement("img");e.src=this.querySelector("img").src,e.alt=this.querySelector("img").alt,s.appendChild(e)}const r=document.createElement("div");r.className="lightbox-info",r.innerHTML=`\n                <h3 class="lightbox-title">${e}</h3>\n                <p class="lightbox-desc">${t}</p>\n            `,s.appendChild(r),o.style.display="flex",setTimeout((()=>{o.classList.add("visible")}),50),v=Array.from(h).indexOf(this),g(),document.body.style.overflow="hidden"}))})),r.addEventListener("click",(function(){o.classList.remove("visible"),setTimeout((()=>{o.style.display="none";const e=s.querySelector("video");e&&e.pause()}),300),document.body.style.overflow="auto"})),a.addEventListener("click",(function(){v>0?v--:v=h.length-1,L(v)})),l.addEventListener("click",(function(){v<h.length-1?v++:v=0,L(v)})),document.addEventListener("keydown",(function(e){"Escape"===e.key&&o.classList.contains("visible")&&r.click(),"ArrowLeft"===e.key&&o.classList.contains("visible")&&a.click(),"ArrowRight"===e.key&&o.classList.contains("visible")&&l.click()})),o.addEventListener("click",(function(e){e.target===o&&r.click()})),p(),e.forEach((e=>{e.classList.contains("featured-item")&&e.setAttribute("data-featured","true"),e.classList.contains("wide-item")&&e.setAttribute("data-wide","true"),e.classList.contains("tall-item")&&e.setAttribute("data-tall","true")})),"IntersectionObserver"in window){const t=new IntersectionObserver(((e,t)=>{e.forEach((e=>{if(e.isIntersecting){const i=e.target,o=i.querySelector("img"),s=i.querySelector("video");o&&o.getAttribute("data-src")&&(o.src=o.getAttribute("data-src"),o.removeAttribute("data-src")),s&&s.getAttribute("data-src")&&(s.src=s.getAttribute("data-src"),s.removeAttribute("data-src")),t.unobserve(i)}}))}));e.forEach((e=>{t.observe(e)}))}e.forEach((e=>{e.addEventListener("mousemove",(function(e){const t=this.getBoundingClientRect(),i=e.clientX-t.left,o=e.clientY-t.top,s=i/t.width*100,n=(50-o/t.height*100)/10,c=(s-50)/10;this.style.transform=`perspective(1000px) rotateX(${n}deg) rotateY(${c}deg) scale3d(1.05, 1.05, 1.05)`})),e.addEventListener("mouseleave",(function(){this.style.transform=""}))}));const b=new IntersectionObserver((e=>{e.forEach((e=>{const t=e.target;e.isIntersecting||t.pause()}))}),{threshold:.5});function r(){currentVideo&&(currentVideo.pause(),currentVideo=null),o.classList.remove("active"),document.body.style.overflow=""}if(document.querySelectorAll(".video-item video").forEach((e=>{b.observe(e),e.hasAttribute("poster")||e.setAttribute("poster","/images/gallery/video-poster.jpg")})),t.forEach((i=>{i.addEventListener("click",(()=>{t.forEach((e=>e.classList.remove("active"))),i.classList.add("active");const o=i.dataset.filter;y.classList.add("loading"),setTimeout((()=>{e.forEach((e=>{const t="all"===o||e.dataset.category===o;e.style.display=t?"block":"none";const i=e.querySelector("video");i&&!t&&i.pause()})),y.classList.remove("loading")}),300)}))})),document.querySelectorAll(".video-item").forEach((e=>{const t=e.querySelector("video");e.querySelector(".video-indicator");e.addEventListener("click",(t=>{t.preventDefault(),function(e){const t=e.classList.contains("video-item"),i=t?e.querySelector("video").cloneNode(!0):e.querySelector("img").cloneNode(!0);s.innerHTML="",s.appendChild(i),t&&(i.controls=!0,i.autoplay=!0,i.loop=!0,currentVideo=i,i.addEventListener("loadedmetadata",(()=>{i.play().catch(console.error)})));o.classList.add("active"),document.body.style.overflow="hidden"}(e)})),e.addEventListener("mouseenter",(()=>{t.paused&&t.play().catch((()=>{console.log("Autoplay prevented")}))})),e.addEventListener("mouseleave",(()=>{t.paused||(t.pause(),t.currentTime=0)}))})),r.addEventListener("click",r),o.addEventListener("click",(e=>{e.target===o&&r()})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&o.classList.contains("active")&&r()})),"loading"in HTMLImageElement.prototype)document.querySelectorAll('video[loading="lazy"]').forEach((e=>{e.src=e.dataset.src}));else{const e=new IntersectionObserver((t=>{t.forEach((t=>{if(t.isIntersecting){const i=t.target;i.src=i.dataset.src,e.unobserve(i)}}))}));document.querySelectorAll('video[loading="lazy"]').forEach((t=>{e.observe(t)}))}}));